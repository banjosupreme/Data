

<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="wally.css">
    <script type = "text/javascript" src ="d3/d3.js"></script>
    <script type="text/javascript" src="emissions.data.js"></script>

</head>
<body>
    <script type = "text/javascript">
    
  
  
    var CO230=["China","UnitedStatesofAmerica","India","RussianFederation","Japan","Germany","KoreaSouth","Iran","Canada","SaudiArabia","Mexico","UnitedKingdom","Indonesia","Brazil","Italy","Australia","SouthAfrica","France","Turkey","Poland","Ukraine","Spain","Thailand","Kazakhstan","Egypt","Malaysia","Argentina","Venezuela","UnitedArabEmirates","Netherlands"];
    var Total30=["China","UnitedStatesofAmerica","India","RussianFederation","Indonesia","Brazil","Japan","Canada","Germany","Mexico","Iran","KoreaSouth","Australia","UnitedKingdom","SaudiArabia","Nigeria","France","Italy","SouthAfrica","Malaysia","Argentina","Venezuela","Turkey","Ukraine","Thailand","Spain","Pakistan","Poland","DemRepofCongo","Kazakhstan"];
    var CH430=["China","UnitedStatesofAmerica","RussianFederation","India","Brazil","Indonesia","Nigeria","Mexico","Angola","Australia","Canada","Pakistan","Iraq","Kuwait","Uzbekistan","Argentina","Sudan","Iran","Myanmar","Vietnam","Libya","Thailand","Ukraine","Ethiopia","Malaysia","France","Venezuela","DemRepofCongo","Colombia","Turkey"];
    var N2030=["China","UnitedStatesofAmerica","Brazil","Indonesia","RussianFederation","DemRepofCongo","India","Argentina","France","Cameroon","Angola","Myanmar","CentralAfricanRepublic","Germany","Sudan","Canada","Pakistan","Ethiopia","Zambia","Iran","Colombia","UnitedKingdom","Burundi","Madagascar","Australia","Nigeria","Italy","Ukraine","Spain","Tanzania"];
    var FGas30=["UnitedStatesofAmerica","China","Japan","India","RussianFederation","KoreaSouth","Mexico","Germany","Canada","France","Italy","SouthAfrica","UnitedKingdom","Australia","Brazil","Israel","Venezuela","Spain","Malaysia","Thailand","SaudiArabia","Philippines","Argentina","Algeria","Poland","Netherlands","Iran","Egypt","Singapore","Turkey"];

    
     var CH430xo=["China","UnitedStatesofAmerica","RussianFederation","India","Brazil","Indonesia","Nigeria","Mexico","Angola","Australia","Canada","Pakistan","Iraq","Uzbekistan","Argentina","Sudan","Iran","Myanmar","Vietnam","Thailand","Ukraine","Ethiopia","Malaysia","France","Venezuela","DemRepofCongo","Colombia","Turkey"];
     var N2030xo=["China","UnitedStatesofAmerica","Brazil","Indonesia","RussianFederation","DemRepofCongo","India","Argentina","France","Cameroon","Angola","Myanmar","Germany","Sudan","Canada","Pakistan","Ethiopia","Zambia","Iran","Colombia","UnitedKingdom","Burundi","Madagascar","Australia","Nigeria","Italy","Ukraine","Spain","Tanzania"];
     
    
    
    
    var colours = {UnitedStatesofAmerica: "#1f77b4", China: "#ff7f0e", Japan: "#0033FF", Germany: "#9933CC", France: "#A27AFE", UnitedKingdom: "#8c564b",Brazil: "#e377c2",RussianFederation: "#CC6666",Italy: "#bcbd22",
                    India: "#17becf",Canada: "#9467bd" ,Australia: "#7f7f7f" ,Spain: "#FF99FF", Mexico: "#99CCFF", KoreaSouth: "#663366", Indonesia: "#993300", Turkey: "#999900", Netherlands: "#FF8C00", SaudiArabia: "#556B2F",
                    Switzerland: "#008B8B", Iran: "#d62728", Sweden: "#FFFF00", Algeria: "#000066", Poland: "#CC3333", Belgium: "#00CC00", Argentina: "#2ca02c", Austria: "#660000", Thailand: "#6600FF" , SouthAfrica: "#FFCC66", 
                    UnitedArabEmirates: "#B9264F", Angola: "#FFE920", Burundi: "#FF800D", Cameroon: "#D1A0A0", CentralAfricanRepublic: "#93EEAA", Colombia: "#FF4AFF", DemRepofCongo: "#B6BA18", Egypt: "#FF4848", Ethiopia: "#E469FE",
                    Iran: "#FF73B9", Iraq: "#FFE920", Israel: "#FFBD82", Kazakhstan:"#F70000", Kuwait: "#FFC4FF", Libya: "#27DE55", Madagascar: "#BABA21", Myanmar: "#93BF96", Nigeria: "#DB00DB", Pakistan: "#75ECFD", Philippines: "#FF9797",
                    Singapore: "#D97BFD", Sudan: "#9A03FE", Tanzania: "#FF9C42", Ukraine: "#C27E3A", Uzbekistan: "#C48484", Venezuela: "#FFD34F", Vietnam: "#79FC4E", Zambia: "#F900F9", Malaysia: "#DAAF85"};
                    
    var plotw = 0.95*window.innerWidth;
    var ploth = 0.5*window.innerHeight;
    var slack = 0.2*window.innerHeight;
    var svgh = 0.7*window.innerHeight;
    
    var CO2base = 1960;
    var totalbase = 1990;
    var CH4base = 1990;
    var N2Obase = 1990;
    var FGasbase = 1990;
    
    
    var CO2end = 2012;
    var totalend = 2012;
    var CH4end = 2012;
    var N2Oend = 2012;
    var FGasend = 2012;
  
    var cPop = function(yearData)
    {
        var outArray = new Array(yearData.length + 1);
        sum = 0;
    
        for(var j = 0; j < yearData.length; j++)
        {
            outArray[j] = sum;
            sum += yearData[j].population; 
        }   
        outArray[outArray.length-1] = sum; 
        
        return outArray;
    }
    
    var dataPoint = function(key, year, lookup, orig)
    {
        var retVal = {};
        retVal.id = key;
        retVal.rect = orig[key];
        retVal.usage = lookup[key].data[year - lookup[key].base][0];
        retVal.perCap = lookup[key].data[year - lookup[key].base][1];
        retVal.population = Population[key].data[year - Population[key].base];
        retVal.info =   lookup[key].name+", "+year+"\nPopulation: "+pString[key].data[year - pString[key].base]+"\nTotal Emissions: "+retVal.usage+" MtCO2\nPer Person: "+retVal.perCap+" Tons\n"; 
        
        return retVal;

    }
    
    var cmp1 = function(x, y)
    {
        return x.usage - y.usage;    
    }
    var cmp2 = function(x, y)
    {
        return x.perCap - y.perCap;
    }
    var cmp3 = function(x, y)
    {
        return x.population - y.population;
    }
     
    var insert = function(dataPoint, mode, data)
    {
        if (mode == 0)
        {
            cmp = cmp1;
        }
        else if (mode == 1)
        {
            cmp = cmp2;
        }
        else if (mode == 2)
        {
            cmp = cmp3;
        }

        for(var j = 0; j < data.length; j++)
        {
            if(cmp(dataPoint,data[j])> 0)
                break;
        
        }

        data.splice(j,0,dataPoint);
            
    } 
     
     
    var setUpAnimation = function(countries,dataSource,base,stop)
     {
        dataset = {};
        dataset.data = new Array();
        dataset.cPops = new Array();
        dataset.base = base;

        
        var maxPop = -1;
        var maxperCap = -1;

        
        orig = {};
        for(var l = 0; l < countries.length; l++)
        {
            orig[countries[l]]=l;        
        }
        
        for(var year = dataset.base; year < stop; year++)
        {
            var yearData = new Array();
            
            
            for(var l = 0; l < countries.length; l++)
            {
                if (year < dataSource[countries[l].base])
                {
                    continue;
                }
                var dp = dataPoint(countries[l], year, dataSource, orig);
                if (dp.perCap > maxperCap)
                {
                    maxperCap = dp.perCap;
                }
                insert(dp,0,yearData);                
            }
            
            var cp = cPop(yearData);
            
            if (cp[cp.length-1]>maxPop)
            {
                maxPop = cp[cp.length-1];
            }
            
            var origDataOrder = new Array(yearData.length)
            for(var l = 0; l < countries.length; l++)
            {
                origDataOrder[yearData[l].rect] = yearData[l];
                origDataOrder[yearData[l].rect].yearOrder = l;
            }
            dataset.data.push(origDataOrder); 
            dataset.cPops.push(cp);
        } 

        dataset.axscale = d3.scale.linear().domain([0,maxPop]).range([0,plotw-100]);    
        dataset.ayscale = d3.scale.linear().domain([0,maxperCap]).range([0,ploth]);

        return dataset;
     }
     
     var initialPlot = function(dataset)
     {
        var plot = d3.select("body").append("svg").attr("width", plotw).attr("height", svgh);
        plot.selectAll("rect").data(dataset.data[0]).enter().append("rect")
                .attr("y", function(input, i){return ploth - dataset.ayscale(input.perCap);})
                .attr("width", function(input){return dataset.axscale(input.population);})
                .attr("height", function(input){return dataset.ayscale(input.perCap);})
                .attr("fill", function(input){ return colours[input.id];})
                .attr("stroke", function(input){ return colours[input.id];})
                .attr("fill-opacity", 0.25)
                .attr("stroke-width", 1)
                .attr("x", function(input, i){ return 100 +  dataset.axscale(dataset.cPops[0][input.yearOrder]);})
                .on("mouseover", function(input) {
                        plot.append("text")
					   .attr("id", "tooltip")
					   .attr("text-anchor", "middle")
					   .attr("font-family", "sans-serif")
					   .attr("font-size", "11px")
					   .attr("font-weight", "bold")
					   .attr("fill", "black")
					   .text(input.info);

			   })
			   .on("mouseout", function() {
					d3.select("#tooltip").remove();					
			   })
                .append("title").text(function(input){return input.info;});
                
         return plot;
          
     }
     

     



    var plotYear = function(dataset, year, plot)
     {
 
        plotData = dataset.data[year - dataset.base];
        
        plot.selectAll("rect")
            .data(plotData)
            .transition()
            .attr("y", function(input){ return (ploth - dataset.ayscale(input.perCap));})
            .attr("width", function(input){return dataset.axscale(input.population);})
            .attr("height", function(input){return dataset.ayscale(input.perCap);})
            .attr("fill", function(input){ return colours[input.id];})
            .attr("fill-opacity", 0.25)
            .attr("stroke", function(input){ return colours[input.id];})
            .attr("stroke-width", 1)
             .attr("x", function(input, i){ return 100 + dataset.axscale(dataset.cPops[year - dataset.base][input.yearOrder]);});
                
        plot.selectAll("rect").select("title").text(function(input,i){return input.info;});
                 
     } 
     
     </script>
     
     
     This text should come before all the plots <br>
     
     <script type = "text/javascript">
         
         var CO2data = setUpAnimation(CO230,TotalCO2,CO2base,CO2end);

         var CO2plot = initialPlot(CO2data);
         
         var cyear = CO2data.base + 1;
         
         var animCO2 = function()
         {
            if (cyear==CO2end)
                cyear = CO2data.base;
            plotYear(CO2data, cyear, CO2plot);
            cyear+=1;
         }
         
           
         setInterval(animCO2, 2000);

     
    </script><br>
    
    
    OK, that should show the CO2 plot <br>
    
    <script type = "text/javascript">

        
       var Totaldata = setUpAnimation(Total30,TotalGHG, totalbase, totalend);
        var totalplot = initialPlot(Totaldata);
         
        var tyear = Totaldata.base + 1;
         
         var animtotal = function()
         {
            if (tyear==totalend)
                tyear = Totaldata.base;
            plotYear(Totaldata, tyear, totalplot);
            tyear+=1;
         }
          
         setInterval(animtotal, 2000);
          
    </script><br>
    
    That should be the total<br>
    
    <script type = "text/javascript">
   
        var CH4data = setUpAnimation(CH430,TotalCH4, CH4base, CH4end);
        var ch4plot = initialPlot(CH4data);
         
        var chyear = CH4data.base + 1;
         
         var animch4 = function()
         {
            if (chyear==CH4end)
                chyear = CH4data.base;
            plotYear(CH4data, chyear, ch4plot);
            chyear+=1;
         }
           
         setInterval(animch4, 2000); 
          
    </script><br>
    
    That should be CH4<br>
    
        <script type = "text/javascript">
   
        var CH4xodata = setUpAnimation(CH430xo,TotalCH4, CH4base, CH4end);
        var ch4xoplot = initialPlot(CH4xodata);
         
        var chxoyear = CH4xodata.base + 1;
         
         var animch4xo = function()
         {
            if (chxoyear==CH4end)
                chxoyear = CH4xodata.base;
            plotYear(CH4xodata, chxoyear, ch4xoplot);
            chxoyear+=1;
         }
           
         setInterval(animch4xo, 2000); 
          
    </script><br>
    
    Nitrous Oxide below<br>
    
     <script type = "text/javascript">

       var N2Odata = setUpAnimation(N2030, TotalN2O, N2Obase, N2Oend);
       var nplot = initialPlot(N2Odata);
         
        var nyear = N2Odata.base + 1;
         
        var animn2o = function()
        {
            if (nyear==N2Oend)
            {
                nyear = N2Odata.base;
            }
            plotYear(N2Odata, nyear, nplot);
            nyear+=1;
         }
        
           
         setInterval(animn2o, 2000);
                                        
    
    </script><br>
    Nitrous Oxide without the outliers <br>
    
    <script type = "text/javascript">
 
       var N2Oxodata = setUpAnimation(N2030xo, TotalN2O, N2Obase, N2Oend);
       var nxoplot = initialPlot(N2Oxodata);
         
        var nxoyear = N2Oxodata.base + 1;
         
        var animn2oxo = function()
        {
            if (nxoyear==N2Oend)
            {
                nxoyear = N2Oxodata.base;
            }
            plotYear(N2Oxodata, nxoyear, nxoplot);
            nxoyear+=1;
         }
        
           
         setInterval(animn2oxo, 2000);
                                        
    
    </script><br>

    

    
    F-Gas below. <br>
    
    <script type = "text/javascript">

        
        var FGasdata = setUpAnimation(FGas30, TotalFGas,FGasbase, FGasend);
        var fgasplot = initialPlot(FGasdata);
         
        var fyear = FGasdata.base + 1;
         
        var animfgas = function()
        {
            if (fyear==FGasend)
            {
                fyear = FGasdata.base;
            }
            plotYear(FGasdata, fyear, fgasplot);
            fyear+=1;
         }
        
           
         setInterval(animfgas, 2000); 
     
    </script><br>
    
F-Gas
    
</body>
</html>
